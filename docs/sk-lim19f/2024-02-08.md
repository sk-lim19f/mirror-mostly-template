# 4. 스위치: 2계층 장비

-   네트워크의 가장 핵심장비인 스위치는 2계층 주소인 MAC 주소를 기반으로 동작
-   스위치는 네트워크 중간에서 패킷을 받아 필요한 곳에만 보내주는 네트워크의 중재자 역할
-   스위치의 기본 동작 외에도 한 대의 장비에서 논리적으로 네트워크를 분리할 수 있는 VLAN 기능과 네트워크의 루프를 방지하는 스패팅 트리 프로토콜(STP)과 같은 기능을 기본적으로 가지고 있음

## 4.1 스위치 장비 동작

-   스위치: 패킷을 동시에 여러장비가 서로 간섭 없이 통신하도록 도와주는 장비
-   스위치를 사용하면 여러 단말이 한꺼번에 통신할 수 있어 통신하기 위해 기다리거나 충돌 때문에 대기하는 문제가 해결되고 네트워크 전체의 통신 효율성이 향상
-   스위치의 핵심 역할은 누가 어느 위치에 있는지 파악하고 실제 통신이 시작되면 자신이 알고 있는 위치로 패킷을 정확히 전송하는 것
-   스위치가 2계층 주소를 이해하고 단말의 주소인 MAC 주소와 단말이 위치하는 인터페이스 정보를 매핑한 MAC 주소 테이브을 갖고있어서 가능
-   스위치는 전송하려는 패킷의 헤더 안에 있는 2계층 목적지 주소를 확인하고 MAC 주소 테이블에서 해당 주소가 어느 포트에 있는지 확인해 해당 패킷을 그 포트로만 전송
-   만약 테이블에 없는 도착지 수로를 가진 패킷이 스위치로 들어오면 스위치는 전체 포트로 패킷을 전송

### 4.1.1. 플러딩

-   스위치를 부팅하면 넽워크 관련 정보가 없음
-   이때 스위치는 네트워크 통신을 중재하는 자신의 역할을 하지 못하고 허브처럼 동작
-   허브는 패킷이 들어온 포트를 제외하고 모든 포트로 패킷을 전달
-   스위치가 허브와 같이 모든 포트로 패킷을 흘리는 동작 방식을 플러딩이라고 함
-   이런 플러딩 동작은 스위치의 정상적인 동작이지만 이런 동작이 많아지면 스위치가 제 역할을 못함

### 4.1.2 어드레스 러닝

-   스위치가 패킷의 도착지인 MAC 주소를 확인하여 원하는 포트로 포워딩하는 스위치의 동작을 정상적으로 수행하려면 MAC 주소 테이블을 만들고 유지
-   MAC 주소 테이블을 만들고 유지하는 과정을 어드레스 러닝이라고 함

### 4.1.3 포워딩/필터링

-   패킷이 스위치에 들어온 경우, 도착지 MAC 주소를 확인하고 자신이 가진 MAC 테이블과 비교해 맞는 정보가 있으면 매치되는 해당 포트로 패킷을 포워딩함
-   이때 다른 포트로는 해당 패킷을 보내지 않으므로 이 동작을 필터링이라고 함
-   스위치는 일반적인 유니캐스트에 대해서만 포워딩과 필터링 작업을 수행

## 4.2 VLAN

-   스위치에서는 오래 전부터 VLAN이라는 가상화 기술을 사용
-   VLAN: 하나의 물리 스위치에서 여러 개의 네트워크를 나누어 사용할 수 있는 기술

### 4.2.1 VLAN이란?

-   VLAN은 물리적 배치와 상관없이 LAN을 논리적으로 분할, 구성하는 기술
-   VLAN을 나누면 하나의 장비를 서로 다른 네트워크를 갖도록 논리적으로 분할한 것이므로 유니캐스트뿐만 아니라 브로드캐스트도 VLAN 간에 통신할 수 없음
-   VLAN을 사용하면 물리적 구성과 상관없이 네트워크를 분리할 수 있고 물리적으로 다른 층에 있는 단말이 하나의 VLAN을 사용해 동일한 네트워크로 묶을 수 있음
-   분리된 단말 간에는 3계층 장비를 통해 통신

### 4.2.2 VLAN의 종류와 특징

-   VLAN 할당 방식에는 포트 기반의 VLAN과 MAC 주소 기반의 VLAN 방식이 있음
-   스위치를 논리적으로 분할해 사용하는 것이 목적인 VLAN을 포트 기반 VLAN이라고 부름
-   사용자들의 자리 이동이 많아지면서 MAC 기반 VLAN이 개발
    -   스위치의 고정 포트에 VLAN을 할당하는 것이 아니라 스위치에 연결되는 단말의 MAC 주소를 기반으로 VLAN을 할당하는 기술
    -   단말에 따라 VLAN 정보가 바뀔 수 있어 다이나믹 VLAN이라고도 부름

### 4.2.3 VLAN 모드(Trunk/Access)동작 방식

-   포트 기반 VLAN에서는 스위치의 각 포트에 사용할 VLAN을 설정하는데 한 대의 스위치에 연결되더라도 서로 다른 VLAN이 설정된 포트 간에는 통신할 수 없음
-   VLAN이 다르면 별도의 분리된 스위치에 연결된 것과 같으므로 VLAN 간 통신이 불가능
-   스위치에 3개의 VLAN이 구성되어 있는 경우, 각 VLAN이 스위치 간에 통신하려면 3개의 포트가 필요
-   VLAN을 더 많이 사용하는 중/대형 네트워크에서 이렇게 VLAN별로 포트를 연결하면 장비간의 연결만으로도 많은 포트가 낭비
-   이 문제를 해결하기 위한 것이 VLAN 태그 기능
-   태그 기능은 하나의 포트에 여러 개의 VLAN을 함께 전송할 수 있게 함
-   이 포트를 태그포트 또는 트렁크 포트라고 함
-   태그 포트를 사용하면 VLAN마다 통신하기 위해 필요했던 여러개의 포트를 하나로 묶어 사용할 수 있으므로 포트 낭비 없이 네트워크를 더 유연하게 디자인 가능
-   태그 포트는 여러 개의 VLAN, 즉 여러 네트워크를 하나의 물리적 포트로 전달하는데 사용되고 언태그 포트는 하나의 VLAN에 속한 경우에만 사용
