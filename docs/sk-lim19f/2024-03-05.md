## 11.4 MC-LAG

-   서로 다른 스위치 간의 실제 MAC 주소 대신 가상 MAC 주소를 만들어 논리 인터페이스로 LACP 구성
-   MC-LAG 기술을 이용하면 단일 스위치로 LACP를 구성해 대역폭을 활장할 것인지, 서로 다른 스위치로 구성해 장비 이중화로 가용성을 확보할 것인지를 선택할 수 있음

### 11.4.1 MC-LAG 동작 방식

-   피어 장비
    -   MC-LAG을 구성하는 장비를 피어 장비라고 함
-   MC-LAG 도메인(Domain)
    -   두 Peer 장비를 하나의 돈리 장비로 구성하기 위한 영역 ID
    -   Peer 장비는 이 영역 ID를 통해 상대방 장비가 Peer를 맺으려는 장비인지 판단
-   피어 링크(Peer-Link)
    -   MC-LAG을 구성하는 두 Peer 장비 간의 데이터 트래픽을 전송하는 인터링크

## 11.5 게이트웨이 이중화

### 11.5.1 게이트웨이 이중화란?

-   L2 통신
    -   특정 호스트가 동일한 서브넷에 있는 내부 네트워크와 통신할 때는 ARP를 직접 브로드캐스트해 출발지와 목적지가 직접 통신
-   L3 통신
    -   외부 네트워크인 경우, 목적지와 통신하기 위해 게이트웨이를 통해서 하는 통신
-   게이트웨이 역할을 하는 두 대의 장비가 하나의 IP 주소를 가지는 것
-   LACP와 유사하게 하나의 IP 주소와 하나의 MAC 주소를 갖고 하단 호스트들이 그 가상 IP와 MAC 주소를 알게 되어 장애가 발생해도 통신이 가능
-   이런 경우 사용하는 프로토콜이 FHRP(First Hop Redundancy Protocol)라는 게이트웨이 이중화 프로토콜
-   게이트웨이 이중화 프로토콜을 사용하면 두 라우터는 실제 IP 외에 추가로 가상 IP 주소와 가상 IP에 대한 MAC 주소를 동일하게 갖음
-   게이트웨이 이중화 프로토콜의 가상 IP는 그룹 내에서 우선순위가 높은 장비가 Active 상태로 유지하고 ARP 요청에 응답
-   하단 호스트들이 사용할 게이트웨이 IP 주소가 이 가상 IP 주소
-   게이트웨이 이중화 프로토콜 그룹 장비 중 가상 IP에 대한 Active 상태를 가진 장비에 문제가 발생하면 Standby 상태인 장비가 Standbt에서 Active 상태로 변경
-   호스트 입장에서는 게이트웨이 IP 주소를 가진 장비가 한 대 이상으로 구성되어 있어 Active 상태의 게이트웨이 장비에 장애가 발생하더라도 게이트웨이와의 통신이 끊기지 않으므로 외부 네트워크와 지속적인 통신을 함

### 11.5.2 FHRP

-   FHRP는 외부 네트워크와 통신하기 위해 사용되는 게이트웨이 장비를 두 대 이상의 장비로 구성할 수 있는 프로토콜
-   FHRP를 이용해 FHRP 그룹 내의 장비가 동일한 가상 IP를 갖도록 설정하고 FHRP를 설정할 때는 우선순위 값을 이용해 어떤 장비가 가상 IP 주소에 대한 액티브 역할을 할 것인지 결정
-   FHRP 그룹의 장비는 물리적으로 다른 장비이지만 가상 IP와 가상 IP MAC 주소도 동일
-   FHRP 기술에 대한 표준 프로토콜은 VRRP(Virtual Router Redundancy Protocol)

### 11.5.3. 올 액티브 게이트웨이 이중화

-   피어 장비 모두 게이트웨이 역할을 할 수 있음에도 불구하고 트래픽이 불필요하게 우회하므로 비 효율적
-   MC-LG 기술을 사용할 때는 게이트웨이 이중화 가상 IP의 MAC 주소를 액티브 장비와 스탠 바이 장비에서 모두 사용할 수 있도록 해 게이트웨이를 액티브-액티브 형태로 구성하는 기능을 제공
-   게이트웨이을 액티브-액티브로 구성하면 액티브 장비로 들어오는 트래픽은 물론 스탠바이 장비로 들어오는 트래픽도 스탠바이 장비에서 직접 처리해 트래픽 흐름을 최적화

### 11.5.4 애티캐스트 게이트웨이

-   게이트웨이가 한 곳에 위치하게 되면 모든 트래픽이 하나의 게이트웨이를 거쳐 통신하게 되므로 통신이 비효율적으로 이루어지게 됨
-   이런 경우, 애니캐스트 게이트웨이 기술을 적용하면 각 위치에 같은 주소를 가지는 게이트웨이가 여러 개 동작
-   게이트웨이가 여러 곳에 위치하므로 하나의 게이트웨이에 문제가 발생해도 랙 하나에서만 장애가 발생하고 다른 위치에서는 외부로 통신하는 데는 문제가 없음
