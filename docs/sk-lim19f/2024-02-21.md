## 8.3 네트워크 확인을 위한 명령어

-   서버에서 네트워크 상태를 확인하는 데 필요한 다양한 명령어가 있음
-   네트워크에 서버를 처음 연결할 때 서버의 네트워크 설정을 확인하기 위해 사용
-   갑자기 서버가 정상적으로 통신이 되지 않거나 서비스가 정상적으로 제공되지 않는 문제가 발생할 때 더 유용하게 사용될 수 있음

### 8.3.1 ping(Packet InterNet Groper)

-   네트워크 상태를 확인할 때 가장 많이 사용하는 명령어는 ping
-   ping은 IP 네트워크를 통해 특정 목적지까지 네트워크가 잘 동작하고 있는지 확인하는 네트워크 명령어
-   상대방 호스트가 살아 있는지 확인하는 것이 이 명령어의 최대 목표이지만 두 호스트 간의 통신을 위한 경로, 즉 라우팅 경로가 정상적으로 구성되어 있는지도 함께 체크할 수 있음
-   ICMP(Internet Control Message Protocol)라는 인터넷 프로토콜을 사용하고 ICMP의 제어 메시지를 통해 여러 가지 네트워크 상태를 파악할 수 있음

```
$ ping [옵션] 목적지_IP 주소
```

-   더 상세한 정보를 파악하기 위해 여러가지 옵션을 사용해 ping을 체크하는 횟수, 데이터 크기 등을 지정
    -   ping -c (count)
        -   ping을 보내는 패킷(ECHO_REQUEST)을 몇 번 보내고 종료할 것인지를 지정
        -   기본 설정은 강제로 정지(CTRL+C)할 때까지 패킷을 지속적으로 보냄
    -   ping -l (interval)
        -   패킷을 보내는 시간 간격
        -   기본 설정값은 1초
        -   슈퍼 유저의 경우, 0.2 이하로 설정 가능
    -   ping -i (interface)
        -   패킷을 보낼 때, 출발지 주소를 지정
        -   실제 IP 값을 지정하거나 인터페이스 이름을 지정하면 출발지 주소가 변경됨
        -   이 옵션을 사용하지 않는 경우, 라우팅 테이블에 의해 나가는 인터페이스(Outgoing-Interface)의 IP 주소가 출발지 주소가 됨
    -   ping -s (packetsize)
        -   패킷 크기를 지정
        -   기본 설정 값은 56바이트(8바이트의 ICMP 헤더가 추가로 붙어 64바이트를 송신)

### 8.3.3 traceroute(리눅스)

-   traceroute는 출발지부터 통신하거나 목적지까지의 네트워크 경로를 확인할 때 사용하는 네트워크 명령어
-   ping은 목적지 단말이 잘 동작하는지 확인하는 데 사용되고 icmp 메시지를 이용해 중간 경로에 문제가 있을 때 이것을 잘 확인할 수 있었지만 traceroute는 중간 경로의 더 상세한 정보를 얻는 데 사용
-   출발지 pc에서 목적지까지의 라우팅 경로를 확인할 수 있고 목적지까지의 통신에 문제가 있을 때, 어느 구간부터 문제가 발생했는지 찾아 낼수 있음
-   추가로 목적지까지의 네트워크 응답 시간이 느린 경우, 어느 구간에서 응답시간이 느려지는지도 알아낼 수 있음
-   traceroute는 IP 헤더의 TTL 필드를 이용
-   TTL을 1부터 1씩 증가시키면서 목적지에 도달할 때까지 패킷을 반복적으로 전송하면서 경로를 추적
-   인터넷 구간에서 경로를 찾지 못하거나 잘못 전송된 패킷이 무제한적으로 계속 돌아다니지 않도록 IP 헤더에 페킷이 살아 있을 수 있는 한계를 명시하는데 이정보를 TTL이라고 함
-   즉, traceroute 경로 추적은 IP 헤더인 3계층 정보에 의한 경로 추적이므로 2계층 이하의 스위치 장비 추적은 불가능
-   라우팅이 동작하는 라우터나 L3 스위치와 같은 3계층 장비의 경로만 확인

```
$ traceroute [옵션] 목적지_IP 주소
```

-   traceroute 경로 추적은 화면상에 모든 경로가 표기되지 않을 수 있음
-   보안상의 이슈로 중간에 있는 보안 장비에서 icmp 메시지나 UDP 패킷을 차단하는 경우나 중간의 라우터 장비에서 자신의 IP가 노출되는 것을 막기 위해 traceroute icmp 메시지에 대해 응답하지 않을 때는 응답시간이 아닌 \*\*\*로 표기

### 8.3.4 tcptraceroute

-   ping과 tcping의 관계처럼 traceroute도 경로 정보뿐만 아니라 서비스 포트를 추가로 확인할 수 있는 traceroute 명령어
-   tcptraceroute는 traceroute와 유사하게 출발지와 목적지까지의 경로를 확인하지만 실제 서비스 포트를 이용해 경로를 추적하므로 최종 목적지까지 서비스 포트가 정상적으로 열리는지 확인할 수 있고 만약 열리지 않는다면 어느 구간부터 서비스가 막히는지 확인할 수 있음

### 8.3.5 netstat(network statistics)

-   netstat은 서버의 다양한 네트워크 상태를 확인하는데 사용하는 명령어
-   여러가지 네트워크 관련 정보를 확인할 수 있어 사용 범위가 매우 넓지만 서비스 포트 상태를 확인하는 용도로 가장 많이 사용
-   현재 서버에서 특정 서비스가 정상적으로 열려 있는지(LISTENING), 또는 외부 서비스와 TCP 세션이 정상적으로 맺어져 있는지(ESTABLISHED), 서비스가 정상적으로 종료되고 있는지(TIME_WAIT, FIN_WAIT, CLOSE_WAIT) 여부 등을 netstat 명령어로 확인할 수 있음

```
$ netstat [옵션]
```

-   주요 옵션
    -   netstat -a, --all
        -   모든 연결과 수신 대기 포트 표시
    -   netstat -n, --numeric
        -   주소와 포트 번호를 숫자 형식으로 표시(예: http → 80)
    -   netstat -r, --route
        -   라우팅 테이블 표시
    -   netstat -i, --interface
        -   인터페이스별 입출력 패킷 통계
    -   netstat -s, --statistics
        -   네트워크에 통계 데이터 출력
    -   netstat -p, --programs
        -   PID와 프로그램 이름 출력
    -   netstat -t, --tcp
        -   TCP만 출력(TCP, TCPv6)
    -   netstat -4/-6
        -   IPv4나 IPv6에 대해 출력

### 8.3.6 ss(socket statistics)

-   ss는 소켓 정보를 확인할 수 있는 네트워크 명령어

```
$ ss [옵션] [필터]
```

### 8.3.7 nslookup(name server lookup)

-   nslookup은 DNS에 다양한 도메인 관련 내용을 질의해 결괏값을 전송받을 수 있는 네트워크 명령
-   가장 자주 사용되는 질의는 특정 도메인에 매핑된 IP 주소를 확인하기 위해 사용

### 8.3.8 telnet(tele network)

-   텔넷은 원격지 호스트에 터미널 연결을 위해 사용되는 매우 오래된 표준 프로토콜
-   telnet은 평문을 사용하므로 네트워크에 접근 가능한 해커에 의해 통신 내용을 감청당할 수 있어 보안을 중시하는 최근 요구사항을 충족시키지 못함
-   서비스 확인을 위한 텔넷의 사용법은 다음과 같음

```
$ telnet 목적지 IP 서비스 포트
```

### 8.3.10 tcpdump

-   tcpdump는 네트워크 인터페이스로 오가는 패킷을 캡처해 보는 기능의 명령어
-   장애 처리나 패킷 분석이 필요할 때 자주 사용
-   tcpdump 명령어를 사용하면 네트워크 인터페이스로 오가는 모든 패킷을 캡처 가능
