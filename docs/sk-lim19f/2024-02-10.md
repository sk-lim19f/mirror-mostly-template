# 5. 라우터/L3 스위치: 3계층 장비

-   라우터(Router)는 3계층에서 동작하는 여러 네트워크 장비의 대표격으로 경로를 지정해주는 장비
-   라우터에 들어오는 패킷의 목적지 IP 주소를 확인하고 자신이 가진 경로 정보를 이용해 패킷을 최적의 경로로 포워딩

## 5.1 라우터의 동작 방식과 역할

-   라우터는 다양한 경로 정보를 수집해 최적의 경로를 라우팅 테이블에 저장한 후 패킷이 라우터로 들어오면 도착지 IP 주소와 라우팅 테이블을 비교해 최선의 경로로 패킷을 내보냄
-   스위치와 반대로 라우터는 들어온 패킷의 목적지 주소가 라우팅 테이블에 없으면 패킷을 버림

### 5.1.1 경로 지정

-   라우터의 가장 중요한 역할은 경로 지정
-   경로 정보를 모아 라우팅 테이블을 만들고 패킷이 라우터로 들어오면 패킷의 도착지 IP 주소를 확인해 경로를 지정하고 패킷을 포워딩
-   IP 주소는 네트워크 주소와 호스트 주소로 나뉜 계층 구조를 기반으로 설계되어 로컬 네트워크와 원격지 네트워크를 구분할 수 있고 네트워크 주소를 기반으로 경로를 찾아갈 수 있음
-   라우터는 이 IP 주소를 확인해 원격지에 있는 적절한 경로로 패킷을 포워딩
-   라우터는 경로를 지정해 패킷을 포워딩하는 역할을 두 가지로 구분해 수행

    -   경로 정보를 얻는 역할
        -   IP 주소를 입력하면서 자연스럽게 인접 네트워크 정보를 얻는 방법
        -   관리자가 직접 경로 정보를 입력하는 방법
        -   라우터끼리 서로 경로 정보를 자동으로 교환하는 방법
    -   경로 정보를 확인하고 포워딩하는 역할

### 5.1.2 브로드캐스트 컨트롤(Broadcast Control)

-   라우터는 패킷을 원격지로 보내는 것을 목표로 개발되어 3계층에서 동작하고 분명한 도착지 정보가 있을 때만 통신을 허락
-   쓸모없는 통신이 네트워크를 차지하는 것을 최대한 막으려고 노력
-   라우터는 바로 연결되어 있는 네트워크 정보를 제외하고 경로 습득 설정을 하지 않으면 패킷을 포워딩 할 수 없음
-   라우터의 기본 동작은 멀티캐스트 정보를 습득하지 않고 브로드캐스트 패킷을 전달하지 않음
-   라우터의 이 기능을 이용해 브로드캐스트가 다른 네트워크로 전파되는 것을 막을 수 있음
-   이 기능을 "브로드캐스트 컨트롤/멀티캐스트 컨트롤"이라고 함

### 5.1.3 프로토콜 변환

-   라우터의 또 다른 역할은 서로 다른 프로토콜로 구성된 네트워크를 연결하는 것
-   LAN 기술이 WAN 기술로 변환되어야만 인터넷과 같이 원격지 네트워크와의 통신이 가능했고 이 역할을 라우터가 담당
-   라우터는 3계층에서 동작하는 장비이므로 3계층 주소 정보를 확인하고 그 정보를 기반으로 동작
-   라우터에 패킷이 들어오면 2계층까지의 헤더 정보를 벗겨내고 3계층 주소를 확인한 후 2계층 헤더 정보를 새로 만들어 외부로 내보냄
-   그래서 라우터에 들어올 때 패킷 2계층 헤더 정보와 나갈 때 패킷의 2계층 헤더 정보가 다름

### 5.2 경로 지정 - 라우팅/스위칭

-   라우터가 패킷을 처리할 때는 크게 두 가지 작업을 수행
    -   경로 정보를 얻어 경로 정보를 정리하는 역할
    -   정리된 경로 정보를 기반으로 패킷을 포워딩하는 역할
-   라우터는 자신이 분명히 알고 있는 주소가 아닌 목적지를 가진 패킷이 들어오면 해당 패킷을 버리므로 패킷이 들어오기 전에 경로 정보를 충분히 수집하고 있어야 라우터가 정상적으로 동작
-   라우터는 서브넷 단위로 라우팅 정보를 습득하고 라우팅 정보를 최적화하기 위해 서머리 작업을 통해 여러 개의 서브넷 정보를 뭉쳐 전달

### 5.2.1 라우팅 동작과 라우팅 테이블

-   단말부터 목적지까지의 경로를 모두 책임지는 것이 아니라 인접한 라우터까지만 경로를 지정하면 인접 라우터에서 최적의 경로를 다시 파악한 후 라우터로 패킷을 포워딩
-   네트워크를 한 단계씩 뛰어넘는다는 의미로 이 기법을 홉-바이-홉(Hop-by-Hop) 라우팅이라고 부름
-   인접한 라투러를 넥스트 홉(Next Hop)이라고 부름
-   라우터는 패킷이 목적지로 가는 전체 경로를 파악하지 않고 최적의 넥스트 홉을 선택
-   넥스트 홉을 지정할 때는 일반적으로 세 가지 방법을 사용
    -   다음 라우터의 IP를 지정하는 방법(넥스트 홉 IP 주소)
    -   라우터의 나가는 인터페이스를 지정하는 방법
    -   라우터의 나가는 인터페이스와 다음 라우터의 IP를 동시에 지정하는 방법
-   라우터가 패킷을 어디로 포워딩할지 경로를 선택할 때는 출발지를 고려하지 않음
-   출발지와 상관없이 목적지 주소와 라우팅 테이블을 비교해 어느 경로로 포워딩할지 결정
-   그래서 라우팅 테이블을 만들 때는 목적지 정보만 수집하고 패킷이 들어오면 목적지 주소를 확인해 패킷을 넥스트 홉으로 포워딩
-   라우팅 테이블에 저장하는 데이터
    -   목적지 주소
    -   넥스트 홉 IP 주소, 나가는 로컬 인터페이스(선택 가능)

> 루프가 없는 3계층: TTL(Time To Live)

-   3계층의 IP 헤더에는 TTL이라는 필드가 있음.
-   이 필드는 패킷이 네트워크에 살아 있을 수 있는 시간(홉)을 제한
-   패킷이 영구적으로 사라지지 않는다면 장비 간에 동일한 패킷이 핑퐁을 치거나 인터넷에 사라지지 않는 유령 패킷이 넘쳐남
-   그래서 모든 패킷은 TTL이라는 수명값을 가짐
-   TTL은 실제 초와 같은 시간이 아닌 홉을 지칭하며 하나의 홉을 지날 때마다 TTL 값은 1씩 줄어듬
